<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Chatbot</title>
    <link rel="stylesheet" href="sytle.css">
</head>
<body>
    <div class="header">Gemini Chatbot</div>

    <div class="container">
        
        <div class="chat-history-controls">
            <button id="decreaseFontSizeButton">-</button>
            <button id="increaseFontSizeButton">+</button>
            <button id="resetFontSizeButton">Reset</button> <!-- New reset button -->
            <span>Font Size</span>
        </div>
        
        <div class="chat-history" id="chatHistory">
            <!-- Initial welcome message (now added dynamically in JS if history is empty) -->
        </div>
        <div id="errorMessage" class="error-message"></div>
      
        <div class="chat-input-area">
            <textarea id="messageInput" placeholder="Type your message..." rows="1"></textarea>
            <button id="sendMessageButton">Send</button>
            <button id="stopMessageButton" class="hidden">Stop</button> <!-- New Stop button -->
        </div>
        

         <div class="system-instruction-section">
            <label for="systemInstructionInput">Background / Model Character (System Instruction):</label>
            <textarea id="systemInstructionInput" placeholder="Define model's persona, context, or instructions here. E.g., 'You are a helpful assistant that provides concise answers.'"></textarea>
            <button id="clearSystemInstructionButton">Remove Background Instruction</button>
        </div>


        <div class="chat-actions-section">
            <button id="removeLastEntryButton">Remove Last Entry</button>
            <button id="regenerateSystemReplyButton">Re-generate Reply</button>
            <button id="cleanThinkingSignatureButton">Clean Thinking Signature</button> <!-- New button -->
        </div>
       
        <!-- Debug button for raw chat history -->
        <div class="raw-chat-history-section">
            <div class="debug-controls">
                <button id="debugButton">Toggle Raw Chat (Debug)</button>
            </div>
            <div id="rawChatContent" class="hidden"> <!-- Content to be toggled -->
                <label for="rawChatHistoryInput">Raw Chat History (JSON):</label>
                <textarea id="rawChatHistoryInput" placeholder="Edit chat history as JSON here..."></textarea>
                <button id="applyRawHistoryButton">Apply Raw History</button>
            </div>
        </div>

        <!-- Debug section for raw API request and response -->
        <div class="api-debug-section">
            <button id="showApiDebugButton">Show Last API Request/Response</button>
            <div id="apiDebugContent" class="hidden">
                <h4>Last API Request Body:</h4>
                <pre id="apiRequestBody"></pre>
                <h4>Last API Response:</h4>
                <pre id="apiResponseBody"></pre>
            </div>
        </div>

        <div class="api-key-section">
            <label for="geminiApiKey">Gemini API Key:</label>
            <input id="geminiApiKey" type="text" placeholder="Enter your Gemini API Key">
            <button id="setApiKeyButton">Set Key</button>
        </div>

        <div class="model-selection-section">
            <label for="geminiModel">Select Model:</label>
            <select id="geminiModel">
                <option value="gemini-3-pro-preview">gemini-3-pro-preview</option>
                <option value="gemini-3-flash-preview">gemini-3-flash-preview</option>
                <option value="gemini-2.5-pro">gemini-2.5-pro</option>
                <option value="gemini-2.5-flash" selected>gemini-2.5-flash</option>
                <option value="gemini-2.5-flash-lite">gemini-2.5-flash-lite</option>
            </select>
        </div>

        <!-- New section for Thinking Config -->
        <div id="thinkingConfigSection" class="thinking-config-section">
            <div id="thinkingBudgetContainer" class="thinking-control-container hidden">
                <label for="thinkingBudgetInput">Thinking Budget (Non-Gemini3, -1 for default):</label>
                <input id="thinkingBudgetInput" type="number" value="-1" min="-1">
            </div>
            <div id="thinkingLevelContainer" class="thinking-control-container hidden">
                <label for="thinkingLevelSelect">Thinking Level (Gemini3):</label>
                <select id="thinkingLevelSelect">
                    <option value="low">low</option>
                    <option value="high">high</option>
                </select>
            </div>
        </div>

        <!-- New section for Thought Signature Config -->
        <div class="thought-signature-config-section">
            <label>
                <input type="checkbox" id="saveThoughtSignatureCheckbox" checked>
                Save thought signature for future model response
            </label>
            <button id="cleanupAllThoughtSignaturesButton" class="cleanup-button">Cleanup All Thought Signatures in History</button>
        </div>

        <div class="chat-actions-section">
            <button id="saveChatButton">Save Chat (to file)</button>
            <input type="file" id="loadChatFileInput" accept=".json" style="display: none;">
            <button id="loadChatButton">Load Chat (from file)</button>
            <button id="clearAllHistoryButton">Clear All History</button>
        </div>



         <div id="tokenStats" class="token-stats">
            <!-- Token stats will be rendered here by JavaScript -->
         </div>
         <div id="costStats" class="token-stats">
            <!-- Cost stats will be rendered here by JavaScript -->
         </div>
    </div>

    <script src="../price.js"></script>
    <script src="chatbot.js" defer></script>
</body>
</html>